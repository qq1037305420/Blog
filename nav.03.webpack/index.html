<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | Happy Coding</title>
    <meta name="description" content="学无止境...">
    
    
    <link rel="preload" href="/Blog/assets/css/0.styles.cbb02bc7.css" as="style"><link rel="preload" href="/Blog/assets/js/app.58ef2f9d.js" as="script"><link rel="preload" href="/Blog/assets/js/2.50c720c6.js" as="script"><link rel="preload" href="/Blog/assets/js/4.f88fd85e.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.a6f0d6df.js"><link rel="prefetch" href="/Blog/assets/js/11.848c0561.js"><link rel="prefetch" href="/Blog/assets/js/12.804cd54b.js"><link rel="prefetch" href="/Blog/assets/js/3.2e2b8a56.js"><link rel="prefetch" href="/Blog/assets/js/5.63bcd3f3.js"><link rel="prefetch" href="/Blog/assets/js/6.31011b59.js"><link rel="prefetch" href="/Blog/assets/js/7.aaf87856.js"><link rel="prefetch" href="/Blog/assets/js/8.263635dc.js"><link rel="prefetch" href="/Blog/assets/js/9.526f4392.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.cbb02bc7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">Happy Coding</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/nav.01.externals/" class="nav-link">Externals</a></div><div class="nav-item"><a href="/Blog/nav.02.common/" class="nav-link">Common</a></div><div class="nav-item"><a href="/Blog/nav.03.webpack/" class="nav-link router-link-exact-active router-link-active">Webpack</a></div><div class="nav-item"><a href="/Blog/nav.04.cordova/" class="nav-link">Cordova</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/nav.01.externals/" class="nav-link">Externals</a></div><div class="nav-item"><a href="/Blog/nav.02.common/" class="nav-link">Common</a></div><div class="nav-item"><a href="/Blog/nav.03.webpack/" class="nav-link router-link-exact-active router-link-active">Webpack</a></div><div class="nav-item"><a href="/Blog/nav.04.cordova/" class="nav-link">Cordova</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Blog/nav.03.webpack/" class="active sidebar-link">Webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#依赖工具webpack-cli" class="sidebar-link">依赖工具webpack-cli</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#文件配置" class="sidebar-link">文件配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#定义webpack-config-js" class="sidebar-link">定义webpack.config.js</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#使用path解析绝对路径" class="sidebar-link">使用path解析绝对路径</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#配置环境变量" class="sidebar-link">配置环境变量</a></li></ul></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#loaders" class="sidebar-link">Loaders</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#css-loaders" class="sidebar-link">css loaders</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#图片loader" class="sidebar-link">图片loader</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#字体-icon-loader" class="sidebar-link">字体 icon loader</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#jsloader" class="sidebar-link">jsLoader</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#react" class="sidebar-link">React</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#vue" class="sidebar-link">Vue</a></li></ul></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#webpack-优化" class="sidebar-link">webpack 优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#动态加载" class="sidebar-link">动态加载</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#热更新" class="sidebar-link">热更新</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#优化css" class="sidebar-link">优化css</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#优化图片" class="sidebar-link">优化图片</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#cdn-加载" class="sidebar-link">CDN 加载</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#优化" class="sidebar-link">优化</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#treeshaking" class="sidebar-link">Treeshaking</a></li></ul></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#dll-plugin-打包速度优化" class="sidebar-link">DLL Plugin 打包速度优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#打包第三方" class="sidebar-link">打包第三方</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#不引用外部库-node-module" class="sidebar-link">不引用外部库(node_module)</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#动态加载-2" class="sidebar-link">动态加载</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#打包文件分析工具" class="sidebar-link">打包文件分析工具</a></li><li class="sidebar-sub-header"><a href="/Blog/nav.03.webpack/#抽离第三方模块-splitchunks" class="sidebar-link">抽离第三方模块 splitchunks</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-学习"><a href="#webpack-学习" aria-hidden="true" class="header-anchor">#</a> WEBPACK 学习</h1> <h2 id="依赖工具webpack-cli"><a href="#依赖工具webpack-cli" aria-hidden="true" class="header-anchor">#</a> 依赖工具webpack-cli</h2> <ul><li>默认支持commonjs, es6 esmodle</li> <li>--mode production/development</li> <li>--env.development</li> <li>--config path
<ul><li>ex: ./build/webpack.base.js</li></ul></li></ul> <h2 id="文件配置"><a href="#文件配置" aria-hidden="true" class="header-anchor">#</a> 文件配置</h2> <ul><li><h3 id="定义webpack-config-js"><a href="#定义webpack-config-js" aria-hidden="true" class="header-anchor">#</a> 定义webpack.config.js</h3></li> <li><h3 id="使用path解析绝对路径"><a href="#使用path解析绝对路径" aria-hidden="true" class="header-anchor">#</a> 使用path解析绝对路径</h3> <ul><li>path.resolve(__dirname, path)</li></ul></li> <li><h3 id="配置环境变量"><a href="#配置环境变量" aria-hidden="true" class="header-anchor">#</a> 配置环境变量</h3> <ul><li><div class="language- extra-class"><pre class="language-text"><code>module.exports = (env) =&gt; {

​	console.log(env)

​	let isEnv = env.development

}
</code></pre></div></li> <li><p>新建base,dev,prod文件</p> <ul><li>引入 dev prod</li> <li>两种引入方案
<ul><li>全部引用base</li> <li>分别引用Dev，Prod</li></ul></li></ul></li></ul></li> <li><p>使用webpack-merge合并base 和其他配置</p> <ul><li>merge(base,  dev/prod)</li></ul></li> <li><p>webpack-dev-serve</p> <ul><li>在内存中打包，不会产生文件</li> <li>配置devServer
<ul><li>port: 3000</li> <li>gzip =&gt; compress: true</li> <li>contentBase: path.resolve(__dirname, '../dist')</li></ul></li></ul></li> <li><p>自动生成html文件，并引入打包后的js内容</p> <ul><li><p>public 文件夹中创建index.html</p></li> <li><p>html-webpack-plugin</p> <ul><li><p>webpack.base.js 中引入该plugin</p></li> <li><p>template: path.resolve(Path of Index.html)</p></li> <li><p>filename: index.html</p></li> <li><p>minify: !isDev &amp;&amp; {</p> <p>​		removeAttributeQuotes: true</p> <p>​		collapseWhitespace: true</p> <p>}</p></li></ul></li></ul></li> <li><p>清除输出(dist)的目录 clean-webpack-plugin</p> <ul><li>引入</li></ul></li></ul> <h2 id="loaders"><a href="#loaders" aria-hidden="true" class="header-anchor">#</a> Loaders</h2> <ul><li><p>解析的顺序为从右往左</p> <h3 id="css-loaders"><a href="#css-loaders" aria-hidden="true" class="header-anchor">#</a> css loaders</h3></li> <li><p>css-loader</p> <ul><li>解析css语法</li></ul></li> <li><p>style-loader</p> <ul><li>讲解析的css 变成style标签插入到页面中</li></ul></li> <li><div class="language- extra-class"><pre class="language-text"><code>module: {
​	rules: [
​		{
          test: /\.css$/,
          use: ['style-loader', 'css-loader']`		
​		},
          test: /\.scss$/,
​		}
​	]
}
</code></pre></div></li> <li><p>如果css引入scss</p> <ul><li><p><code>test: /\.css$/,</code></p> <p><code>use: ['style-loader', {</code></p> <p><code>loader: 'css-loader',</code></p> <p><code>options: {importLoaders: 2}</code></p> <p><code>},'postcss-loader', 'sass-loader']</code></p></li></ul></li> <li><p>自动添加前缀</p> <ul><li>postcss</li> <li>autoprefixer</li> <li>postcss.config.js
<ul><li>plugins: [require('autoprefixer')]</li> <li>并且添加.browerslistrc</li></ul></li></ul></li> <li><p>mini-css-extract-plugin</p> <ul><li><p>loader配置isDev? 'style-loader': miniCssExtractPlugin</p></li> <li><p>plugin并引入 !isDev &amp;&amp; new MinicssExtractPlugin({</p> <p>​	filename: 'css/mian.css'</p> <p>})</p></li> <li><p>plugins.filter(Boolean)</p></li> <li><p>生产环境配置</p> <ul><li><p>安装optimize-css-assets-webpack-plugin</p></li> <li><p>optimization: {</p> <p>​	minimizer: [</p> <p>​		new optimize-css-assets-webpack-plugin()</p> <p>​	]</p> <p>}</p></li></ul></li></ul></li> <li><p>terser-webpack-plugin</p> <ul><li>压缩js</li> <li>生产环境中 new 在plugin里面</li></ul></li></ul> <h3 id="图片loader"><a href="#图片loader" aria-hidden="true" class="header-anchor">#</a> 图片loader</h3> <ul><li>file-loader</li> <li>test: /.(jpe?g|png|gif)$/</li> <li>use: {loader: 'url-loader', options: {name: 'image/[name/contentHash].[ext]', limit: 100 * 1024}}
<ul><li>小于100kb的变成base64.大于自动变file-loader</li></ul></li></ul> <h3 id="字体-icon-loader"><a href="#字体-icon-loader" aria-hidden="true" class="header-anchor">#</a> 字体 icon loader</h3> <ul><li>test: /.(woff|ttf|eot|svg)$/</li> <li>use: 'file-loader'</li></ul> <h3 id="jsloader"><a href="#jsloader" aria-hidden="true" class="header-anchor">#</a> jsLoader</h3> <ul><li>babel
<ul><li>@babel/core</li> <li>@babel/preset-env</li> <li>babel-loader 调用core转化时候用preset env</li></ul></li> <li>es6 =&gt; es5
<ul><li>test: /.js&amp;/</li> <li>use: 'babel-loader'</li> <li>添加.babelrc 执行顺序为倒叙</li> <li>presets: {&quot;@babel/preset-env&quot;, {useBuiltIns: 'usage', corejs: 2}}</li> <li>plugins: []</li></ul></li> <li>装饰器
<ul><li>@babel/plugin-proposal-class-properties{loose: true}</li> <li>@babel/plugin-proposal-decorators{legacy: true}</li></ul></li> <li>corejs</li> <li>@babel/plugin-transform-runtime</li></ul> <h3 id="react"><a href="#react" aria-hidden="true" class="header-anchor">#</a> React</h3> <ul><li>@babel/present-react</li> <li>@babel/present-typescript</li> <li></li></ul> <h3 id="vue"><a href="#vue" aria-hidden="true" class="header-anchor">#</a> Vue</h3> <ul><li>vue loader
<ul><li>并且引入vue loader plugin</li></ul></li> <li>vue templatete compiler</li> <li>如若使用ts安装 vue property decorator
<ul><li>@babel/present-typescript, {allExtentions: true}</li></ul></li></ul> <h2 id="webpack-优化"><a href="#webpack-优化" aria-hidden="true" class="header-anchor">#</a> webpack 优化</h2> <ul><li><h3 id="动态加载"><a href="#动态加载" aria-hidden="true" class="header-anchor">#</a> 动态加载</h3> <ul><li>import().then()</li> <li>需要引入 @babel/plugin-syntax-dynamic-import</li></ul></li> <li><h3 id="热更新"><a href="#热更新" aria-hidden="true" class="header-anchor">#</a> 热更新</h3> <ul><li>devserver: {hot: true}</li> <li>webpack.NamedModulesPlugin 热更新模块</li> <li>webpack.HotModleReplacementPlugin 热更新插件</li></ul></li></ul> <h3 id="优化css"><a href="#优化css" aria-hidden="true" class="header-anchor">#</a> 优化css</h3> <ul><li>插件 purgecss-webpack-plugin glob</li> <li>glob.sync(path(任意文件夹下的任意文件), {nodir: true})</li> <li>purgeCssWebpackPlugin
<ul><li>只能配合minicss extract plugin</li> <li>传入paths(glob.sync(src/**/*), {nodir: true})</li></ul></li></ul> <h3 id="优化图片"><a href="#优化图片" aria-hidden="true" class="header-anchor">#</a> 优化图片</h3> <ul><li>image-webpack-loader</li> <li>减低分辨率,清晰度.</li> <li>test: /\png/</li> <li>use: []</li> <li>npm 搜索这个然后拷入配置</li></ul> <h3 id="cdn-加载"><a href="#cdn-加载" aria-hidden="true" class="header-anchor">#</a> CDN 加载</h3> <p>需要在index.html中引入</p> <pre><code>external: {

'jquery': '$'

}
</code></pre> <p>add asset html cdn webpack plugin</p> <pre><code>`new addcdnplugin(true, {`
	`jquery: 'https: //'`
`})`
</code></pre> <h3 id="优化"><a href="#优化" aria-hidden="true" class="header-anchor">#</a> 优化</h3> <p>使用了哪些模块</p> <p>optimization:  {usedExports: true}</p> <h3 id="treeshaking"><a href="#treeshaking" aria-hidden="true" class="header-anchor">#</a> Treeshaking</h3> <p>只支持es6语法</p> <p>引用变量是否被删除 副作用</p> <p>package.json</p> <p>css 不是副作用</p> <pre><code>sideEffects: [

	&quot;**/*.css&quot;

]
</code></pre> <h4 id="es6-module"><a href="#es6-module" aria-hidden="true" class="header-anchor">#</a> es6 module</h4> <h4 id="scope-hoisting"><a href="#scope-hoisting" aria-hidden="true" class="header-anchor">#</a> Scope hoisting</h4> <p>会直接导出值</p> <p>把里面其他代码都优化掉了</p> <h2 id="dll-plugin-打包速度优化"><a href="#dll-plugin-打包速度优化" aria-hidden="true" class="header-anchor">#</a> DLL Plugin 打包速度优化</h2> <p>manifest.json</p> <p>react: '打包后的文件'</p> <p>reactdom: '打包好的文件'</p> <p>产生缓存文件</p> <p>dllPlugin = require(webpacl).DllPlugin</p> <pre><code>{

​	plugins: [

​		new DllPlugin({name: 'react', path: path.resolve(__dirname, 	'dll/manifest.json')})

​	]

}
</code></pre> <ul><li><p>内部引用 dllreferenceplugin = require('weback').DllReferencePlugin</p> <ul><li>new dllRefer({</li></ul> <p>manifext: path</p> <p>})</p> <ul><li>同时需要引用</li></ul></li> <li><p>add asset html webpack plugin</p> <ul><li>添加资源插件</li> <li>new add({filepath: path.resolve(__dirname, '*.dll.js')})</li></ul></li></ul> <h3 id="打包第三方"><a href="#打包第三方" aria-hidden="true" class="header-anchor">#</a> 打包第三方</h3> <p><code>entry: [react, react-dom]</code></p> <p><code>output: {library: filename, libraryTarget: 'var/commonjs/commonjs2/umd/this'}</code></p> <p>node 用commonjs2</p> <p>全局 就不配置S</p> <h3 id="不引用外部库-node-module"><a href="#不引用外部库-node-module" aria-hidden="true" class="header-anchor">#</a> 不引用外部库(node_module)</h3> <ul><li>webpack-node-externals</li></ul> <h3 id="动态加载-2"><a href="#动态加载-2" aria-hidden="true" class="header-anchor">#</a> 动态加载</h3> <p><code>import(/*webpackChunkname: ''video*/, './calc')</code></p> <p><code>output: {</code></p> <p>​	<code>chunkFilename: '[name].min,js'</code></p> <p><code>}</code></p> <p>原理jsonp</p> <h3 id="打包文件分析工具"><a href="#打包文件分析工具" aria-hidden="true" class="header-anchor">#</a> 打包文件分析工具</h3> <p>entry 有三种写法 字符串,数组,对象</p> <p><code>entry:{a: &quot;./src/a.js&quot;, b: './src/b.js'}</code></p> <p><code>output: {filename: [name].js}</code></p> <p>HtmlWebpackPlugin: ({chunks: ['a'], chunksSortMode: 'manual'})</p> <p>webpack-bundle-analyzer 代码分析插件 .BundleAnalyzerPlugin</p> <p>new bundleANalyzerPlugin() 生产环境下</p> <h3 id="抽离第三方模块-splitchunks"><a href="#抽离第三方模块-splitchunks" aria-hidden="true" class="header-anchor">#</a> 抽离第三方模块 splitchunks</h3> <ul><li>不要和业务放到一起</li> <li>添加缓存</li></ul> <p>生产环境下 将第三方模块进行抽离</p> <p>官网查配置</p> <p><code>optimization: {splitChunks: []}</code></p> <p><img src="/Blog/assets/img/webpack_optimazation.46b2ed16.png" alt="optimazation"> <a href="./static/webpack_optimazation.png">下载图片</a></p> <h4 id="dllplugin-不要和splitchunks-一起使用"><a href="#dllplugin-不要和splitchunks-一起使用" aria-hidden="true" class="header-anchor">#</a> dllplugin 不要和splitchunks 一起使用</h4> <ul><li>splitchunks 构建之时抽离出来</li> <li>dll plugin 构建之前抽出来</li></ul> <h4 id="speed-measure"><a href="#speed-measure" aria-hidden="true" class="header-anchor">#</a> Speed measure</h4> <p><code>const smw = new SpeedMeasureWebpackPlugin();</code></p> <p><code>module.exports = env =&gt; {</code></p> <p><code>return smw.wrap({})</code></p> <p><code>}</code></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/Blog/assets/js/app.58ef2f9d.js" defer></script><script src="/Blog/assets/js/2.50c720c6.js" defer></script><script src="/Blog/assets/js/4.f88fd85e.js" defer></script>
  </body>
</html>
